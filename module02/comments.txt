В первом задании, действительно, искал единственный лучший "средний-чек"
Сейчас береться средний "средний-чек", и в оконной функции он еще раз не рассчитывается.